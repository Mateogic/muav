# 多无人机空中基站通信保障系统 —— 技术详解文档

## 目录

- [1. 项目概述](#1-项目概述)
- [2. 环境设计](#2-环境设计)
  - [2.1 场景模型](#21-场景模型)
  - [2.2 移动模型](#22-移动模型)
  - [2.3 通信模型](#23-通信模型)
  - [2.4 时延模型](#24-时延模型)
  - [2.5 能耗模型](#25-能耗模型)
  - [2.6 缓存模型](#26-缓存模型)
  - [2.7 奖励设计](#27-奖励设计)
- [3. 算法设计](#3-算法设计)
  - [3.1 观测空间](#31-观测空间)
  - [3.2 动作空间](#32-动作空间)
  - [3.3 支持的MARL算法](#33-支持的marl算法)
- [4. 仿真流程](#4-仿真流程)

---

## 1. 项目概述

本项目实现了一个基于**多智能体深度强化学习（MARL）**的多无人机空中基站通信保障系统。系统中多个无人机（UAV）作为空中基站，为地面和空中的用户设备（UE）提供通信服务，同时通过宏基站（MBS）进行内容回源。

### 核心优化目标

系统联合优化三个相互依赖的组件：

| 组件                      | 控制方式        | 说明                   |
| ------------------------- | --------------- | ---------------------- |
| **UAV 轨迹规划**    | MARL 智能体控制 | 3D 位置移动决策        |
| **3D 波束赋形控制** | MARL 智能体控制 | 定向天线波束指向       |
| **内容缓存策略**    | GDSF 自适应算法 | 基于请求频率的缓存更新 |

### 优化目标函数

$$
\text{maximize} \quad \alpha_3 \cdot \text{Fairness} + \alpha_{\text{rate}} \cdot \text{Throughput} - \alpha_1 \cdot \text{Latency} - \alpha_2 \cdot \text{Energy}
$$

---

## 2. 环境设计

### 2.1 场景模型

#### 基本参数

| 参数       | 符号                         | 默认值         | 说明         |
| ---------- | ---------------------------- | -------------- | ------------ |
| 区域大小   | $X_{\max} \times Y_{\max}$ | 1000m × 1000m | 仿真覆盖区域 |
| UAV 数量   | $U$                        | 10             | 空中基站数量 |
| UE 数量    | $M$                        | 100            | 用户设备数量 |
| 时隙长度   | $\tau$                     | 1.0s           | 单个决策周期 |
| 每回合步数 | $T$                        | 1000           | 训练回合长度 |

#### UAV 参数

| 参数         | 符号                      | 默认值 | 说明               |
| ------------ | ------------------------- | ------ | ------------------ |
| 最低飞行高度 | $H_{\min}$              | 100m   | UAV 高度下限       |
| 最高飞行高度 | $H_{\max}$              | 500m   | UAV 高度上限       |
| 飞行速度     | $v^{\text{UAV}}$        | 30 m/s | 3D 最大移动速度    |
| 覆盖半径     | $R$                     | 250m   | 3D 球形覆盖范围    |
| 感知范围     | $R^{\text{sense}}$      | 500m   | 邻居 UAV 发现距离  |
| 最小间距     | $d_{\min}^{\text{UAV}}$ | 100m   | UAV 间最小安全距离 |

#### UE 分层模型

系统支持地面和空中 UE 的混合场景：

| UE 类型 | 占比 | 高度范围   | 移动特性    |
| ------- | ---- | ---------- | ----------- |
| 地面 UE | 50%  | $z = 0$  | 2D 随机游走 |
| 空中 UE | 50%  | 50m - 600m | 3D 随机游走 |

#### MBS（宏基站）

- 位置：$(500, 500, 300)$ m（区域中心上空）
- 作为所有内容的回源节点
- 提供回程链路（Backhaul）连接

---

### 2.2 移动模型

#### 2.2.1 UE 移动模型 —— 3D 随机游走（Random Waypoint）

UE 采用经典的**随机游走模型（Random Waypoint Model）**：

**算法流程：**

1. 随机生成目标位置 $(x_{\text{wp}}, y_{\text{wp}}, z_{\text{wp}})$
2. 随机生成到达后的等待时间 $t_{\text{wait}} \in [0, T_{\text{wait}}^{\max}]$
3. 以最大速度 $v^{\text{UE}}_{\max}$ 沿直线移动向目标
4. 到达后等待 $t_{\text{wait}}$ 个时隙
5. 重复步骤 1-4

**数学表达：**

$$
\vec{p}_{\text{UE}}(t+1) = \vec{p}_{\text{UE}}(t) + \min(d_{\max}^{\text{UE}}, \|\vec{p}_{\text{wp}} - \vec{p}_{\text{UE}}(t)\|) \cdot \frac{\vec{p}_{\text{wp}} - \vec{p}_{\text{UE}}(t)}{\|\vec{p}_{\text{wp}} - \vec{p}_{\text{UE}}(t)\|}
$$

**参数设置：**

- 最大移动距离：$d_{\max}^{\text{UE}} = 20$ m/时隙
- 最大等待时间：$T_{\text{wait}}^{\max} = 10$ 时隙

#### 2.2.2 UAV 移动模型 —— 智能体控制

UAV 的移动完全由 MARL 智能体控制：

**动作解释：**

智能体输出 3D 移动向量 $\vec{a}_{\text{move}} = [a_x, a_y, a_z] \in [-1, 1]^3$，系统对向量**模长**进行裁剪（保持方向不变）：

$$
\vec{\Delta p} = \frac{\vec{a}_{\text{move}}}{\max(\|\vec{a}_{\text{move}}\|, 1)} \times v^{\text{UAV}} \times \tau
$$

即动作向量的方向决定移动方向，模长（裁剪到最大为 1）决定移动距离占最大距离的比例。

**位置更新：**

$$
\vec{p}_{\text{UAV}}(t+1) = \text{clip}(\vec{p}_{\text{UAV}}(t) + \vec{\Delta p}, \vec{p}_{\min}, \vec{p}_{\max})
$$

**碰撞避免机制：**

系统采用迭代式碰撞消解算法：

```
for iteration in range(COLLISION_AVOIDANCE_ITERATIONS):
    for each UAV pair (i, j):
        if distance(i, j) < MIN_UAV_SEPARATION:
            # 沿连线方向分离
            direction = normalize(pos_i - pos_j)
            overlap = MIN_UAV_SEPARATION - distance(i, j)
            pos_i += direction * overlap * 0.5
            pos_j -= direction * overlap * 0.5
            mark_collision_violation(i, j)
```

---

### 2.3 通信模型

通信模型是本系统的核心，实现了完整的 **3D 球形覆盖信道模型**，支持多种链路类型和先进的信道建模技术。

#### 2.3.1 链路类型概览

系统包含三类通信链路，使用不同的频段以避免相互干扰：

```
                         ┌─────────────────┐
                         │       MBS       │
                         │  (500,500,300)  │
                         └────────┬────────┘
                                  │
                    ══════════════╪══════════════  Backhaul Link
                    ║  B_backhaul = 40 MHz       ║  (UAV-MBS 回程链路)
                    ║  全双工、点对点            ║
                    ══════════════╪══════════════
                                  │
        ┌─────────────────────────┴─────────────────────────┐
        │                                                   │
        ▼                                                   ▼
    ┌───────┐                                           ┌───────┐
    │ UAV_1 │◄══════════════════════════════════════════│ UAV_2 │
    └───┬───┘        Inter-UAV Link (UAV-UAV)           └───┬───┘
        │            B_inter = 30 MHz                       │
        │            FDM 频分复用                            │
        │                                                   │
   ═════╪═════                                         ═════╪═════
   ║ Edge Link ║                                       ║ Edge Link ║
   ║ B_edge=20MHz                                      ║ B_edge=20MHz
   ║ OFDMA多址 ║                                       ║ OFDMA多址 ║
   ═════╪═════                                         ═════╪═════
        │                                                   │
        ▼                                                   ▼
    ┌───────┐  ┌───────┐                            ┌───────┐  ┌───────┐
    │  UE   │  │  UE   │   ... 同频干扰 ...         │  UE   │  │  UE   │
    └───────┘  └───────┘                            └───────┘  └───────┘
```

**频谱资源分配：**

| 链路类型                | 频段带宽 | 多址方式 | 特点                            |
| ----------------------- | -------- | -------- | ------------------------------- |
| Edge Link (UE-UAV)      | 20 MHz   | OFDMA    | 同一 UAV 的多个 UE 共享带宽     |
| Inter-UAV Link          | 30 MHz   | FDM      | 被多个 UAV 选为协作者时分割带宽 |
| Backhaul Link (UAV-MBS) | 40 MHz   | 点对点   | 全双工，区分上下行功率          |

---

#### 2.3.2 信道增益模型

信道增益模型综合考虑了路径损耗、视距概率和波束增益。

##### 2.3.2.1 仰角计算

仰角（Elevation Angle）是计算 LoS 概率的关键参数：

$$
\theta_{\text{elev}} = \arctan\left(\frac{|z_1 - z_2|}{\sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}}\right)
$$

- 仰角范围：$[0°, 90°]$
- 垂直链路（正上方/正下方）：$\theta_{\text{elev}} = 90°$
- 水平链路：$\theta_{\text{elev}} \approx 0°$

##### 2.3.2.2 路径损耗模型

采用简化的**自由空间路径损耗模型**（Free Space Path Loss）：

$$
L(d) = d^2
$$

其中 $d$ 为发射端与接收端之间的 3D 欧氏距离：

$$
d = \sqrt{(x_1-x_2)^2 + (y_1-y_2)^2 + (z_1-z_2)^2}
$$

> **注**：此简化模型省略了载波频率相关项，将其合并到常数增益因子 $G_0 \cdot g_0$ 中。

##### 2.3.2.3 视距概率模型（LoS Probability）

视距概率决定了链路是 LoS（视距）还是 NLoS（非视距）。系统根据链路类型采用不同的模型：

**（A）地对空链路（Ground-to-Air）—— ITU-R / 3GPP 模型**

当链路中有一端高度低于 50m 时，使用 ITU-R P.1410 / 3GPP TR 36.777 模型：

$$
P_{\text{LoS}}(\theta) = \frac{1}{1 + a \cdot \exp\left(-b \cdot (\theta - a)\right)}, \quad \theta \text{ 以"度"为单位}
$$

其中 $\theta$ 是仰角（度），$(a, b)$ 是环境相关参数。

> **注**：本文采用 3GPP TR 36.777 推荐的 G2A LoS 概率模型。公式中参数 $a$ 同时出现在 Sigmoid 曲线的幅度因子和角度偏移项中，这是标准模型的原始形式。

**环境参数表：**

| 环境类型                  | 参数$a$ | 参数$b$ | 典型 LoS 概率曲线   | 适用场景             |
| ------------------------- | --------- | --------- | ------------------- | -------------------- |
| 郊区 (suburban)           | 4.88      | 0.43      | 仰角 30° 时 ≈100% | 开阔地带、低密度建筑 |
| 城市 (urban)              | 9.61      | 0.16      | 仰角 30° 时 ≈73%  | 普通城市街区         |
| 密集城区 (dense_urban)    | 12.08     | 0.11      | 仰角 30° 时 ≈37%  | 商业中心、高密度区   |
| 高层城区 (highrise_urban) | 27.23     | 0.08      | 仰角 30° 时 ≈4%   | 摩天大楼区域         |

**（B）空对空链路（Air-to-Air）**

当链路双方均在空中（高度 ≥ 50m）时，建筑物遮挡概率较低，采用简化模型：

$$
P_{\text{LoS}}^{\text{A2A}} = 0.8 + 0.2 \cdot \frac{\theta_{\text{elev}}}{90}, \quad \theta_{\text{elev}} \in [0°, 90°]
$$

其中 $\theta_{\text{elev}}$ 为仰角（单位：度）。该模型确保空对空链路的 LoS 概率在 $[0.8, 1.0]$ 范围内，仰角越大概率越高。相比更乐观的 0.9 下界，0.8 的设置更贴近常见空对空信道模型，考虑了远距离水平链路可能被高层建筑或地形遮挡的情况。

##### 2.3.2.4 综合信道增益公式

将路径损耗、LoS 概率和波束增益综合，得到信道增益：

$$
G_{\text{channel}} = \frac{G_0 \cdot g_0 \cdot G_{\text{beam}}}{\bar{L}(d)}
$$

其中**平均路径损耗** $\bar{L}(d)$ 考虑了 LoS 和 NLoS 两种情况：

$$
\bar{L}(d) = P_{\text{LoS}} \cdot L(d) + (1 - P_{\text{LoS}}) \cdot L(d) \cdot L_{\text{NLoS}}
$$

**参数说明：**

| 参数          | 符号                | 值                       | 说明                     |
| ------------- | ------------------- | ------------------------ | ------------------------ |
| 常数增益因子  | $G_0 \cdot g_0$   | $3.244 \times 10^{-4}$ | 包含载波频率、天线效率等 |
| NLoS 额外损耗 | $L_{\text{NLoS}}$ | 10 dB (线性值 10)        | 阴影衰落和绕射损耗       |
| 波束增益      | $G_{\text{beam}}$ | 见 2.3.3 节              | 仅用于 UAV-UE 链路       |

---

#### 2.3.3 3D 波束赋形模型（3GPP TR 38.901）

系统实现了完整的 **3D 波束赋形**（3D Beamforming）模型，UAV 配备定向天线，可以将信号能量集中在特定方向。

##### 2.3.3.1 球坐标系定义

波束方向使用**物理学球坐标系**表示：

```
                    Z+ (天顶, θ=0°)
                    │
                    │   ╱ 波束方向
                    │  ╱  
                    │ ╱ θ (俯仰角)
                    │╱___________
                    ┼────────────► Y+
                   ╱│
                  ╱ │
                 ╱  │
               X+   │
                    │
                    ▼ Z- (天底, θ=180°)
```

| 坐标   | 符号       | 范围                | 定义                        |
| ------ | ---------- | ------------------- | --------------------------- |
| 俯仰角 | $\theta$ | $[0°, 180°]$    | 从 Z+ 轴（天顶）测量的角度  |
| 方位角 | $\phi$   | $[-180°, 180°]$ | XY 平面内从 X+ 轴逆时针测量 |

**俯仰角的物理含义：**

- $\theta = 0°$：正上方（天顶方向）
- $\theta = 90°$：水平方向
- $\theta = 180°$：正下方（天底方向）

##### 2.3.3.2 波束方向单位向量

给定波束方向 $(\theta_0, \phi_0)$，其单位向量（在三个坐标轴的投影）为：

$$
\vec{v}_{\text{beam}} = \begin{pmatrix} \sin\theta_0 \cos\phi_0 \\ \sin\theta_0 \sin\phi_0 \\ \cos\theta_0 \end{pmatrix} = \begin{pmatrix} v_x \\ v_y \\ v_z \end{pmatrix}
$$

##### 2.3.3.3 默认波束指向计算

当智能体不控制波束方向时，波束默认指向关联 UE 的**几何质心**：

$$
\vec{p}_{\text{centroid}} = \frac{1}{N_{\text{UE}}} \sum_{i=1}^{N_{\text{UE}}} \vec{p}_{\text{UE}}^{(i)}
$$

$$
\theta_0 = \arccos\left(\frac{dz}{\|\vec{d}\|}\right), \quad \phi_0 = \arctan2(dy, dx)
$$

其中 $\vec{d} = \vec{p}_{\text{centroid}} - \vec{p}_{\text{UAV}} = (dx, dy, dz)$。

##### 2.3.3.4 波束增益计算（3GPP 天线模型）

波束增益根据目标方向与波束指向之间的**角度偏差**（Angular Deviation）计算。

**Step 1：计算目标方向单位向量**

- $p_X$ 为 $X$ 的位置向量，$\vec{v}_{\text{target}}$ 为从无人机指向目标点的单位向量

$$
\vec{v}_{\text{target}} = \frac{\vec{p}_{\text{target}} - \vec{p}_{\text{UAV}}}{\|\vec{p}_{\text{target}} - \vec{p}_{\text{UAV}}\|}
$$

**Step 2：计算角度偏差（大圆距离）**

$\vec{v}_{\text{beam}}$ 为实际波束指向的单位向量，使用向量点积计算真实的 3D 角度偏差，避免极点附近的数值问题：

- 其中 $\vec{v}_{\text{target}}\cdot \vec{v}_{\text{beam}}=\cos\Delta\psi$

$$
\Delta\psi = \arccos(\vec{v}_{\text{beam}} \cdot \vec{v}_{\text{target}})
$$

**Step 3：计算增益衰减(dB)**

采用 3GPP TR 38.901 的天线模型：

$$
A(\Delta\psi) = \min\left(12 \cdot \left(\frac{\Delta\psi}{\psi_{\text{3dB}}}\right)^2, A_{\max}\right) \quad \text{[dB]}
$$

**Step 4：计算线性波束增益**

$$
G_{\text{beam}} = 10^{(G_{\max} - A(\Delta\psi)) / 10}
$$

**波束参数：**

| 参数         | 符号                  | 值     | 说明               |
| ------------ | --------------------- | ------ | ------------------ |
| 最大天线增益 | $G_{\max}$          | 18 dBi | 波束主瓣方向增益   |
| 3dB 波束宽度 | $\psi_{\text{3dB}}$ | 30°   | 功率下降一半的角度 |
| 旁瓣衰减上限 | $A_{\max}$ (SLA)    | 20 dB  | 最大衰减限制       |

**波束增益随角度偏差的变化：**

| 角度偏差$\Delta\psi$ | 衰减$A$    | 线性增益$G_{\text{beam}}$ |
| ---------------------- | ------------ | --------------------------- |
| 0° (主瓣中心)         | 0 dB         | 63.1 (18 dBi)               |
| 15° (半波束宽度)      | 3 dB         | 31.6 (15 dBi)               |
| 30° (波束边缘)        | 12 dB        | 3.98 (6 dBi)                |
| 38.7°                 | 20 dB        | 0.631 (-2 dBi)              |
| > 38.7° (旁瓣)        | 20 dB (饱和) | 0.631 (-2 dBi)              |

##### 2.3.3.5 波束控制模式

智能体可以通过动作控制波束方向，支持两种模式：

**模式 1：Offset 模式（相对偏移）**

波束方向 = 质心方向 + 智能体偏移

$$
\theta = \theta_0 + a_\theta \times \Delta_{\max}, \quad \phi = \phi_0 + a_\phi \times \Delta_{\max}
$$

其中：

- $(\theta_0, \phi_0)$：指向 UE 质心的方向（自动计算）
- $(a_\theta, a_\phi) \in [-1, 1]^2$：智能体动作
- $\Delta_{\max} = 30°$：最大偏移范围

**模式 2：Absolute 模式（绝对角度）**

智能体直接指定波束方向：

$$
\theta = \frac{a_\theta + 1}{2} \times 180°, \quad \phi = a_\phi \times 180°
$$

---

#### 2.3.4 各链路速率计算

所有链路速率计算基于 **Shannon 容量公式**：

$$
R = B \cdot \log_2(1 + \text{SNR}) \quad \text{或} \quad R = B \cdot \log_2(1 + \text{SINR})
$$

##### 2.3.4.1 UE-UAV 下行链路（Edge Link - Downlink）

**场景**：UAV 向其关联的 UE 发送数据

**多址方式**：OFDMA（正交频分多址）

```
        UAV (发射功率 P_tx)
         │
         │  总带宽 B_edge = 20 MHz
         ▼
    ┌────┴────┬────┴────┬────┴────┐
    │ 子带 1  │ 子带 2  │   ...   │  OFDMA: N 个 UE 平分带宽
    │ B/N     │ B/N     │         │
    ▼         ▼         ▼   
   UE_1      UE_2      ...       UE_N
```

**OFDMA 特性分析：**

在 OFDMA 系统中，总功率和带宽平均分配给 $N$ 个 UE：

- 每个 UE 分配带宽：$B_k = B_{\text{edge}} / N$
- 每个 UE 分配功率：$P_k = P_{\text{tx}} / N$

子载波级别的 SINR 计算：

$$
\text{SINR}_k = \frac{P_k \cdot G_k}{\sigma^2 / N + I / N} = \frac{P_{\text{tx}} \cdot G_k}{\sigma^2 + I}
$$

> 由于功率、噪声和干扰都按 $1/N$ 缩放，OFDMA 子载波的 SINR 等于使用全功率时的全频带 SINR。

**下行速率公式：**

$$
R_{\text{DL}}^{(k)} = \frac{B_{\text{edge}}}{N} \cdot \log_2\left(1 + \frac{P_{\text{tx}}^{\text{UAV}} \cdot G_k}{\sigma^2 + I_{\text{total}}^{(k)}}\right)
$$

**参数：**

| 参数         | 符号                           | 值             | 说明          |
| ------------ | ------------------------------ | -------------- | ------------- |
| 边缘链路带宽 | $B_{\text{edge}}$            | 20 MHz         | UE-UAV 总带宽 |
| UAV 发射功率 | $P_{\text{tx}}^{\text{UAV}}$ | 0.8 W          | 总发射功率    |
| 噪声功率     | $\sigma^2$                   | $10^{-13}$ W | AWGN 噪声     |
| 干扰功率     | $I_{\text{total}}$           | 动态计算       | 来自其他 UAV  |

##### 2.3.4.2 UE-UAV 上行链路（Edge Link - Uplink）

**场景**：UE 向其服务 UAV 发送请求消息

**多址方式**：OFDMA（与下行相同频段，但不同时隙或子帧）

**上行速率公式：**

$$
R_{\text{UL}}^{(k)} = \frac{B_{\text{edge}}}{N} \cdot \log_2\left(1 + \frac{P_{\text{tx}}^{\text{UE}} \cdot G_k}{\sigma^2}\right)
$$

> **注**：上行链路暂不考虑同频干扰（保守简化）

**参数：**

| 参数        | 符号                          | 值    | 说明            |
| ----------- | ----------------------------- | ----- | --------------- |
| UE 发射功率 | $P_{\text{tx}}^{\text{UE}}$ | 0.1 W | 远小于 UAV 功率 |

**典型数值示例**（假设 $G = 10^{-8}$, $N = 10$）：

- SNR = $\frac{0.1 \times 10^{-8}}{10^{-13}}$ = 10,000 (40 dB)
- 上行速率 ≈ $\frac{20}{10}$ × $\log_2(10001)$ ≈ 26.6 Mbps

##### 2.3.4.3 UAV-UAV 链路（Inter-UAV Link）

**场景**：UAV 之间的协作通信（内容共享）

**多址方式**：FDM（频分复用）

```
                    UAV_A (协作者)
                   ╱      │      ╲
        ┌─────────╱       │       ╲─────────┐
        │  频段 1         │          频段 2  │
        │  B/2, P/2       │          B/2, P/2│
        ▼                 │                 ▼
     UAV_1              UAV_2             UAV_3
   (请求者)           (其他)            (请求者)
```

当 UAV_A 被 $N_{\text{collab}}$ 个 UAV 选为协作者时：

- 每条链路分配带宽：$B_{\text{link}} = B_{\text{inter}} / N_{\text{collab}}$
- 每条链路分配功率：$P_{\text{link}} = P_{\text{tx}} / N_{\text{collab}}$
- 每条链路噪声功率：$\sigma_{\text{link}}^2 = \sigma^2 / N_{\text{collab}}$（FDM 子频带噪声与带宽成正比）

**UAV-UAV 速率公式：**

$$
R_{\text{UAV-UAV}} = \frac{B_{\text{inter}}}{N_{\text{collab}}} \cdot \log_2\left(1 + \frac{(P_{\text{tx}} / N_{\text{collab}}) \cdot G}{\sigma^2 / N_{\text{collab}}}\right) = \frac{B_{\text{inter}}}{N_{\text{collab}}} \cdot \log_2\left(1 + \frac{P_{\text{tx}} \cdot G}{\sigma^2}\right)
$$

> **注**：由于 FDM 每条链路使用独立子频带，功率和噪声同时缩放 $1/N$，SNR 保持不变。协作者负载仅影响带宽分配，不影响 SNR。

**参数：**

| 参数           | 符号                  | 值     | 说明               |
| -------------- | --------------------- | ------ | ------------------ |
| UAV 间通信带宽 | $B_{\text{inter}}$  | 30 MHz | 专用频段           |
| 协作者负载     | $N_{\text{collab}}$ | 动态   | 被选为协作者的次数 |

**设计考量**：

- 功率和带宽**同时**平分给各链路（总功率限制模型）
- FDM 方式避免了 UAV 间的相互干扰
- 协作者负载越高，单链路速率越低

##### 2.3.4.4 UAV-MBS 链路（Backhaul Link）

**场景**：UAV 与宏基站之间的回程通信

**工作模式**：全双工、点对点

**（A）上行链路（UAV → MBS）**

用于 UAV 向 MBS 发送内容请求：

$$
R_{\text{Backhaul}}^{\text{UL}} = B_{\text{backhaul}} \cdot \log_2\left(1 + \frac{P_{\text{tx}}^{\text{UAV}} \cdot G_{\text{UAV-MBS}}}{\sigma^2}\right)
$$

**（B）下行链路（MBS → UAV）**

用于 MBS 向 UAV 发送请求的内容数据：

$$
R_{\text{Backhaul}}^{\text{DL}} = B_{\text{backhaul}} \cdot \log_2\left(1 + \frac{P_{\text{tx}}^{\text{MBS}} \cdot G_{\text{UAV-MBS}}}{\sigma^2}\right)
$$

**参数：**

| 参数         | 符号                           | 值     | 说明                     |
| ------------ | ------------------------------ | ------ | ------------------------ |
| 回程链路带宽 | $B_{\text{backhaul}}$        | 40 MHz | UAV-MBS 专用             |
| MBS 发射功率 | $P_{\text{tx}}^{\text{MBS}}$ | 20 W   | 宏基站功率（远大于 UAV） |

**非对称速率**：由于 $P_{\text{tx}}^{\text{MBS}} \gg P_{\text{tx}}^{\text{UAV}}$，下行速率通常远高于上行速率。

---

#### 2.3.5 同频干扰模型

在 Edge Link 频段内，所有 UAV 共享相同的 20 MHz 带宽，存在**同频干扰**（Co-Channel Interference）。

##### 2.3.5.1 干扰场景图示

```
                         UAV_j (干扰源)
                          │ 波束方向 →→→
                          │
                     ┌────┴────┐
                     │ 干扰信号 │  干扰功率 = P_tx × G_interference
                     └────┬────┘
                          │
                          ▼
    UAV_i ─────────────► UE_k ◄──── 期望信号
    (服务UAV)            (被干扰)
  
    SINR = 期望信号功率 / (噪声 + 干扰功率)
```

##### 2.3.5.2 干扰功率计算

对于被 UAV $i$ 服务的 UE $k$，来自所有其他 UAV 的干扰功率：

$$
I_{\text{total}}^{(k)} = \sum_{j \neq i} \mathbb{1}_{\{|\mathcal{U}_j| > 0\}} \cdot P_{\text{tx}}^{\text{UAV}} \cdot G_{j \to k}^{\text{(with beam)}}
$$

其中：

- $\mathbb{1}_{\{|\mathcal{U}_j| > 0\}}$：指示函数，UAV $j$ 有关联 UE 时为 1，否则为 0
- $G_{j \to k}^{\text{(with beam)}}$：从干扰 UAV $j$ 到 UE $k$ 的信道增益（考虑 UAV $j$ 的波束方向）

##### 2.3.5.3 干扰功率详细计算

```python
# 伪代码：计算 UE k 受到的总干扰
def calculate_interference(ue_k, serving_uav_i, all_uavs):
    total_interference = 0
  
    for uav_j in all_uavs:
        if uav_j == serving_uav_i:
            continue  # 跳过服务 UAV
  
        if len(uav_j.associated_ues) == 0:
            continue  # 无关联 UE 的 UAV 不发射，不产生干扰
  
        # 计算干扰链路信道增益（考虑 UAV_j 的波束方向）
        G_interference = calculate_channel_gain(
            ue_k.pos, 
            uav_j.pos, 
            beam_direction=uav_j.beam_direction  # 关键：使用干扰UAV的波束方向
        )
  
        # 干扰功率 = 发射功率 × 信道增益
        interference = P_tx_UAV * G_interference
        total_interference += interference
  
    return total_interference
```

##### 2.3.5.4 波束赋形对干扰的抑制作用

由于干扰功率计算考虑了干扰 UAV 的**波束方向**，波束赋形可以有效降低干扰：

| 场景                     | 角度偏差 | 波束增益      | 干扰影响       |
| ------------------------ | -------- | ------------- | -------------- |
| 干扰 UAV 波束指向 UE_k   | ~0°     | 最大 (18 dBi) | 强干扰         |
| 干扰 UAV 波束偏离 30°   | 30°     | -6 dB         | 中等干扰       |
| 干扰 UAV 波束偏离 > 39° | > 39°   | -2 dBi        | 弱干扰（旁瓣） |

> **设计意义**：智能体可以通过调整波束方向，在服务自身 UE 的同时减少对其他 UAV 所服务 UE 的干扰。

##### 2.3.5.5 SINR 计算示例

假设：

- 服务 UAV 到 UE 的信道增益：$G_{\text{signal}} = 10^{-8}$
- 干扰 UAV 数量：3 个
- 每个干扰 UAV 的信道增益：$G_{\text{interf}} = 10^{-10}$（波束偏离导致衰减）

$$
\text{SINR} = \frac{0.8 \times 10^{-8}}{10^{-13} + 3 \times 0.8 \times 10^{-10}} = \frac{8 \times 10^{-9}}{10^{-13} + 2.4 \times 10^{-10}} \approx 33.2 \text{ (15.2 dB)}
$$

---

#### 2.3.6 通信参数汇总

| 参数类别           | 参数名         | 符号                           | 值                       | 单位 |
| ------------------ | -------------- | ------------------------------ | ------------------------ | ---- |
| **发射功率** | UAV 发射功率   | $P_{\text{tx}}^{\text{UAV}}$ | 0.8                      | W    |
|                    | MBS 发射功率   | $P_{\text{tx}}^{\text{MBS}}$ | 20                       | W    |
|                    | UE 发射功率    | $P_{\text{tx}}^{\text{UE}}$  | 0.1                      | W    |
|                    | UAV 接收功率   | $P_{\text{rx}}$              | 0.1                      | W    |
| **带宽**     | Edge Link 带宽 | $B_{\text{edge}}$            | 20                       | MHz  |
|                    | Inter-UAV 带宽 | $B_{\text{inter}}$           | 30                       | MHz  |
|                    | Backhaul 带宽  | $B_{\text{backhaul}}$        | 40                       | MHz  |
| **噪声**     | AWGN 功率      | $\sigma^2$                   | $10^{-13}$             | W    |
| **信道**     | 常数增益因子   | $G_0 \cdot g_0$              | $3.245 \times 10^{-4}$ | -    |
|                    | NLoS 额外损耗  | $L_{\text{NLoS}}$            | 10                       | dB   |
| **波束**     | 最大天线增益   | $G_{\max}$                   | 18                       | dBi  |
|                    | 3dB 波束宽度   | $\psi_{\text{3dB}}$          | 30                       | °   |
|                    | 旁瓣衰减上限   | SLA                            | 20                       | dB   |
| **环境**     | 默认环境类型   | -                              | urban                    | -    |

---

#### 2.3.7 通信模型的设计特点

1. **3D 全向覆盖**：球坐标系波束模型支持对地面和空中 UE 的服务
2. **概率信道模型**：LoS 概率模型反映了真实城市环境的复杂性
3. **智能波束控制**：MARL 智能体可学习优化波束指向，平衡覆盖与干扰
4. **干扰感知**：SINR 计算考虑了多 UAV 同频干扰
5. **差异化链路**：不同类型链路使用独立频段，多址方式各异
6. **非对称回程**：MBS 高功率确保了回程下行的高速率

---

### 2.4 时延模型

#### 2.4.1 内容请求处理流程

```
┌──────────────────────────────────────────────────────────────┐
│                     请求处理流程                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Case 1: 本地缓存命中                                         │
│  ┌────┐  ① 请求  ┌─────┐  ② 数据  ┌────┐                    │
│  │ UE │ ───────► │ UAV │ ───────► │ UE │                    │
│  └────┘  (UL)    └─────┘   (DL)   └────┘                    │
│  Latency = t_req(UE→UAV) + t_data(UAV→UE)                   │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Case 2: 协作 UAV 缓存命中                                    │
│  ┌────┐ ① ┌─────┐ ② ┌───────────┐ ③ ┌─────┐ ④ ┌────┐      │
│  │ UE │──►│ UAV │──►│Collaborator│──►│ UAV │──►│ UE │      │
│  └────┘   └─────┘   └───────────┘   └─────┘   └────┘      │
│  Latency = t_req(UE→UAV) + t_req(UAV→Collab)                │
│          + t_data(Collab→UAV) + t_data(UAV→UE) + queue_wait │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Case 3: 通过协作 UAV 从 MBS 获取                             │
│  ┌────┐ ┌─────┐ ┌───────────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌────┐│
│  │ UE │►│ UAV │►│Collaborator│►│ MBS │►│Collab│►│ UAV │►│ UE ││
│  └────┘ └─────┘ └───────────┘ └─────┘ └─────┘ └─────┘ └────┘│
│  Latency = Edge + UAV-UAV + Backhaul + queue_waits          │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Case 4: 直接从 MBS 获取                                      │
│  ┌────┐  ①  ┌─────┐  ②  ┌─────┐  ③  ┌─────┐  ④  ┌────┐     │
│  │ UE │ ──► │ UAV │ ──► │ MBS │ ──► │ UAV │ ──► │ UE │     │
│  └────┘     └─────┘     └─────┘     └─────┘     └────┘     │
│  Latency = Edge + Backhaul + queue_wait                     │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 2.4.2 传输时延计算

对于文件 $k$ 的请求，各环节时延为：

**请求消息传输时延：**

$$
t_{\text{req}} = \frac{L_{\text{req}} \times 8}{R_{\text{link}}}
$$

其中 $L_{\text{req}} = 100$ bytes 为请求消息大小。

**数据传输时延：**

$$
t_{\text{data}} = \frac{S_k \times 8}{R_{\text{link}}}
$$

其中 $S_k$ 为文件 $k$ 的大小（bytes）。

#### 2.4.3 排队时延模型

系统采用**全双工 + 跨时隙积压**模型：

**本时隙排队等待：**

$$
t_{\text{queue}} = \max(t_{\text{backlog}}^{\text{tx}} + t_{\text{current}}^{\text{tx}}, t_{\text{backlog}}^{\text{rx}} + t_{\text{current}}^{\text{rx}})
$$

**跨时隙积压更新：**

$$
t_{\text{backlog}}^{\text{next}} = \max(0, t_{\text{total}} - \tau)
$$

其中 $\tau = 1$s 为时隙长度，超出时隙的传输任务积压到下一时隙。

#### 2.4.4 未服务惩罚

对于未被任何 UAV 覆盖的 UE，其时延设为惩罚值：

$$
t_{\text{unserved}} = 60 \text{s}
$$

---

### 2.5 能耗模型

UAV 的能耗分为**飞行能耗**和**通信能耗**两部分。

#### 2.5.1 飞行能耗

$$
E_{\text{fly}} = P_{\text{move}} \cdot t_{\text{move}} + P_{\text{hover}} \cdot t_{\text{hover}}
$$

其中：

- $P_{\text{move}} = 60$ W：移动功率
- $P_{\text{hover}} = 40$ W：悬停功率
- $t_{\text{move}} = \frac{d_{\text{moved}}}{v^{\text{UAV}}}$：移动时间
- $t_{\text{hover}} = \tau - t_{\text{move}}$：悬停时间

#### 2.5.2 通信能耗

$$
E_{\text{comm}} = P_{\text{tx}} \cdot t_{\text{tx}}^{\text{total}} + P_{\text{rx}} \cdot t_{\text{rx}}^{\text{total}}
$$

其中：

- $P_{\text{tx}} = 0.8$ W：发射功率
- $P_{\text{rx}} = 0.1$ W：接收功率

**通信时间的计算特点：**

| 链路类型          | 多址方式 | 时间计算             |
| ----------------- | -------- | -------------------- |
| UE-UAV            | OFDMA    | 取最大值（并行传输） |
| UAV-UAV（请求方） | 点对点   | 累加（串行）         |
| UAV-UAV（协作者） | FDM      | 取最大值（并行传输） |
| UAV-MBS           | 点对点   | 累加（串行）         |

**能耗计算示例：**

$$
t_{\text{tx}}^{\text{total}} = t_{\text{tx}}^{\text{UE-UAV}} + t_{\text{tx}}^{\text{UAV-UAV}} + t_{\text{tx}}^{\text{UAV-MBS}}
$$

（不同频段使用独立射频前端，时间累加）

#### 2.5.3 总能耗

$$
E_{\text{total}} = E_{\text{fly}} + E_{\text{comm}}
$$

---

### 2.6 缓存模型

#### 2.6.1 内容请求模型

UE 的内容请求遵循 **Zipf 分布**：

$$
P(k) = \frac{k^{-\beta}}{\sum_{i=1}^{K} i^{-\beta}}
$$

其中：

- $K = 20$：内容文件总数
- $\beta = 0.6$：Zipf 参数（控制热门程度集中度）

#### 2.6.2 GDSF 缓存策略

系统采用 **GDSF（Greedy-Dual-Size-Frequency）** 缓存策略：

**优先级分数计算：**

$$
\text{Priority}_k = \frac{\text{EMA}_k}{S_k}
$$

其中 EMA（指数移动平均）用于平滑请求频率：

$$
\text{EMA}_k(t) = \alpha \cdot f_k(t) + (1-\alpha) \cdot \text{EMA}_k(t-1)
$$

- $\alpha = 0.5$：平滑因子
- $f_k(t)$：当前时隙文件 $k$ 的请求次数

**缓存更新周期：** 每 $T_{\text{cache}} = 10$ 时隙更新一次

**缓存选择算法：**

```python
sorted_files = sort_by_priority_descending(all_files)
cache = []
used_space = 0
for file in sorted_files:
    if used_space + file.size <= storage_capacity:
        cache.append(file)
        used_space += file.size
```

#### 2.6.3 协作缓存

当本地缓存未命中时，UAV 可从协作者获取内容。

**协作者选择策略：**

1. 计算缺失文件集合：$\mathcal{F}_{\text{miss}} = \mathcal{F}_{\text{req}} \setminus \mathcal{F}_{\text{cache}}$
2. 对每个邻居计算缓存重叠：$\text{overlap}_j = |\mathcal{F}_{\text{miss}} \cap \mathcal{F}_{\text{cache}}^{(j)}|$
3. 选择重叠最大的邻居作为协作者（相同则选最近）

---

### 2.7 奖励设计

#### 2.7.1 多目标奖励函数

$$
r = \alpha_3 \cdot r_{\text{fairness}} + \alpha_{\text{rate}} \cdot r_{\text{rate}} - \alpha_1 \cdot r_{\text{latency}} - \alpha_2 \cdot r_{\text{energy}}
$$

**权重设置：**

| 权重                     | 值  | 说明           |
| ------------------------ | --- | -------------- |
| $\alpha_1$             | 1.0 | 时延惩罚权重   |
| $\alpha_2$             | 0.8 | 能耗惩罚权重   |
| $\alpha_3$             | 1.2 | 公平性奖励权重 |
| $\alpha_{\text{rate}}$ | 1.0 | 吞吐量奖励权重 |

#### 2.7.2 动态归一化机制

为平衡不同量级的指标，采用 **RunningNormalizer**：

1. **对数压缩**：$x' = \log(x + \epsilon)$
2. **EMA 归一化**：$\hat{x} = \frac{x' - \mu}{\sigma}$

其中 $\mu, \sigma$ 使用指数移动平均在线更新。

#### 2.7.3 公平性指标（Jain's Fairness Index）

$$
\text{JFI} = \frac{\left(\sum_{m=1}^{M} c_m\right)^2}{M \cdot \sum_{m=1}^{M} c_m^2}
$$

其中 $c_m$ 是 UE $m$ 的滑动窗口服务覆盖率（最近 100 步内被成功服务的比例）。

**JFI 映射到奖励：**

$$
r_{\text{fairness}} = \text{clip}((JFI - 0.6) \times 5, -2, 2)
$$

#### 2.7.4 惩罚项

| 违规类型 | 惩罚值 | 说明                                  |
| -------- | ------ | ------------------------------------- |
| 碰撞违规 | 1.0    | UAV 间距小于$d_{\min}^{\text{UAV}}$ |
| 边界违规 | 1.0    | UAV 试图飞出边界                      |

**最终奖励缩放：**

$$
r_{\text{final}} = r \times 0.12
$$

---

## 3. 算法设计

### 3.1 观测空间

每个 UAV 智能体的观测向量维度由配置项决定：

$$
\text{OBS\_DIM\_SINGLE} = 3 + K + (N_{\text{nbr}} \times 5) + (N_{\text{UE}} \times 5)
$$

其中：

- $K = \text{NUM\_FILES}$（缓存文件数，当前配置为 20）
- $N_{\text{nbr}} = \text{MAX\_UAV\_NEIGHBORS}$（邻居 UAV 上限，当前配置为 3）
- $N_{\text{UE}} = \text{MAX\_ASSOCIATED\_UES}$（关联 UE 上限，当前配置为 20）

因此在默认配置（NUM_UAVS=10, NUM_UES=100）下：

$$
\text{OBS\_DIM\_SINGLE} = 3 + 20 + 3\times 5 + 20\times 5 = 138
$$

#### 3.1.1 观测结构

```
观测向量 (默认 138 维)
├── 自身状态 (23 维)
│   ├── 归一化位置 [x/X_max, y/Y_max, z/Z_max]  ... 3 维
│   └── 缓存位图 [cache_0, cache_1, ..., cache_19] ... 20 维
│
├── 邻居状态 (3 × 5 = 15 维)
│   └── 每个邻居 (5 维):
│       ├── 相对位置 [Δx, Δy, Δz] / R_sense  ... 3 维
│       ├── 即时帮助能力 (0/1)  ... 1 维
│       └── 缓存互补性 (0~1)  ... 1 维
│
└── 关联 UE 状态 (20 × 5 = 100 维)
    └── 每个 UE (5 维):
        ├── 相对位置 [Δx, Δy, Δz] / R_coverage  ... 3 维
        ├── 归一化请求文件ID  ... 1 维
        └── 本地缓存命中标志 (0/1)  ... 1 维
```

#### 3.1.2 观测特征详解

**（1）自身状态**

| 特征       | 维度 | 范围   | 说明                                                                           |
| ---------- | ---- | ------ | ------------------------------------------------------------------------------ |
| 归一化位置 | 3    | [0, 1] | $(x/1000, y/1000, z/600)$（代码中使用 $Z_{\max}=\text{UE\_MAX\_ALT}=600$） |
| 缓存位图   | 20   | {0, 1} | 第$k$ 位为 1 表示缓存了文件 $k$                                            |

**（2）邻居状态**（最多 3 个最近邻居）

| 特征         | 维度 | 范围    | 计算方式                                                                           |
| ------------ | ---- | ------- | ---------------------------------------------------------------------------------- |
| 相对位置     | 3    | [-1, 1] | $(\vec{p}_{\text{neighbor}} - \vec{p}_{\text{self}}) / R^{\text{sense}}$         |
| 即时帮助能力 | 1    | {0, 1}  | 邻居是否缓存了当前任一所需文件                                                     |
| 缓存互补性   | 1    | [0, 1]  | $1 - \text{Jaccard}(\text{cache}_{\text{self}}, \text{cache}_{\text{neighbor}})$ |

**（3）关联 UE 状态**（最多 $N_{\text{UE}}=\text{MAX\_ASSOCIATED\_UES}$ 个最近 UE；默认配置为 20）

| 特征          | 维度 | 范围   | 说明                                                 |
| ------------- | ---- | ------ | ---------------------------------------------------- |
| 相对位置      | 3    | ~      | $(\vec{p}_{\text{UE}} - \vec{p}_{\text{UAV}}) / R$ |
| 归一化文件 ID | 1    | [0, 1] | $\text{req\_id} / K$                               |
| 缓存命中标志  | 1    | {0, 1} | 本 UAV 是否缓存该请求文件                            |

### 3.2 动作空间

每个 UAV 智能体输出 **5 维连续动作**：

```
动作向量 (5 维)
├── 移动动作 (3 维)
│   ├── dx ∈ [-1, 1]  ... X 方向归一化位移
│   ├── dy ∈ [-1, 1]  ... Y 方向归一化位移
│   └── dz ∈ [-1, 1]  ... Z 方向归一化位移
│
└── 波束控制动作 (2 维)
    ├── beam_θ ∈ [-1, 1]  ... 俯仰角控制
    └── beam_φ ∈ [-1, 1]  ... 方位角控制
```

#### 3.2.1 移动动作解释

**位移向量计算：**

$$
\vec{\Delta p} = \frac{\vec{a}_{\text{move}}}{\max(\|\vec{a}_{\text{move}}\|, 1)} \times v^{\text{UAV}} \times \tau
$$

即动作向量的方向决定移动方向，模长（裁剪到最大为 1）决定移动距离占最大距离的比例。

**示例：**

- $\vec{a} = [1, 0, 0]$：最大速度向 X+ 移动
- $\vec{a} = [0.5, 0.5, 0]$：以约 71% 最大速度沿对角线移动
- $\vec{a} = [0, 0, 0]$：悬停

#### 3.2.2 波束控制动作解释

**Absolute 模式（默认，当前配置 `BEAM_CONTROL_MODE="absolute"`）：**

$$
\theta = (a_\theta + 1) / 2 \times 180°
$$

$$
\phi = a_\phi \times 180°
$$

其中 $\theta \in [0, 180°]$，$\phi \in [-180°, 180°]$。

**Offset 模式（可选，`BEAM_CONTROL_MODE="offset"`）：**

$$
\theta = \theta_0 + a_\theta \times 30°
$$

$$
\phi = \phi_0 + a_\phi \times 30°
$$

其中 $(\theta_0, \phi_0)$ 是指向关联 UE 质心的方向，$30°$ 来自配置 `BEAM_OFFSET_RANGE=30.0`。

### 3.3 支持的 MARL 算法

| 算法             | 类型       | Actor  | Critic    | 特点                 |
| ---------------- | ---------- | ------ | --------- | -------------------- |
| **MADDPG** | Off-policy | 分布式 | 集中式    | 经典 CTDE 框架       |
| **MATD3**  | Off-policy | 分布式 | 双 Critic | 减少 Q 值过估计      |
| **MAPPO**  | On-policy  | 分布式 | 集中式    | 样本效率高，稳定性好 |
| **MASAC**  | Off-policy | 分布式 | 双 Critic | 最大熵探索           |
| **Random** | -          | 随机   | -         | 基线对比             |

#### 网络架构

- **MLP 隐藏层维度**：768
- **Actor 网络**：`obs_dim → 768 → 768 → action_dim`
- **Critic 网络**：`(state_dim + total_action_dim) → 768 → 768 → 1`

#### 关键超参数

| 参数               | 值                   | 说明     |
| ------------------ | -------------------- | -------- |
| Actor 学习率       | $2 \times 10^{-4}$ |          |
| Critic 学习率      | $4 \times 10^{-4}$ |          |
| 折扣因子$\gamma$ | 0.99                 |          |
| 软更新系数$\tau$ | 0.002                |          |
| 经验回放容量       | 500,000              |          |
| Batch 大小         | 1024                 |          |
| 初始随机步数       | 50,000               | 探索阶段 |

---

## 4. 仿真流程

### 每时隙执行流程

```
┌─────────────────────────────────────────────────────────────┐
│                    时隙开始 (t → t+1)                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 1. 环境准备 (_prepare_for_next_step)                 │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● UE 生成内容请求 (Zipf 分布)                        │   │
│  │ ● UE-UAV 关联 (3D 球形覆盖 + 最近选择)               │   │
│  │ ● 设置 UAV 邻居列表                                  │   │
│  │ ● 选择协作 UAV                                       │   │
│  │ ● 计算通信速率                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 2. 获取观测 (_get_obs)                               │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● 构建每个 UAV 的 OBS_DIM_SINGLE 维观测向量          │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 3. 智能体决策 (model.select_actions)                 │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● Actor 网络输出 5 维动作                            │   │
│  │ ● 添加探索噪声 (训练时)                              │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 4. 执行动作 (env.step)                               │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● 应用波束控制动作                                   │   │
│  │ ● 计算同频干扰                                       │   │
│  │ ● 处理内容请求 (计算时延)                            │   │
│  │ ● 更新缓存                                           │   │
│  │ ● 执行 UAV 移动 (碰撞避免)                           │   │
│  │ ● 计算能耗                                           │   │
│  │ ● 计算奖励                                           │   │
│  │ ● 更新 UE 位置                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 5. 学习更新 (model.update)                           │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● 存储经验到 Buffer                                  │   │
│  │ ● 采样 Batch 更新网络                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 附录：快速启动

### 训练

```bash
python main.py train --num_episodes 5000 --gpu_id 0
```

### 测试

```bash
python main.py test --num_episodes 100 --model_path <path> --config_path <path>
```

### 可视化

```bash
python visualize.py --log_path <log_data.json>
```

---

*文档生成时间：2026年1月14日*
